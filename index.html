<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>å¥åº·æ™ºè†³ - ä¸ªæ€§åŒ–å¥åº·è†³é£ŸåŠ©æ‰‹</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<!-- Font Awesome å›¾æ ‡ -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<style>
/* ... ä¹‹å‰çš„æ‰€æœ‰æ ·å¼ä¿æŒä¸å˜ ... */
</style>
</head>
<body>
  <div class="container">
    <!-- ... ä¹‹å‰çš„æ‰€æœ‰HTMLç»“æ„ä¿æŒä¸å˜ ... -->
  </div>

<script>
// ================= å…¨å±€å˜é‡ =================
let healthChart = null;
let allUsersData = [];
let isOnline = false;
let currentChartType = 'age';

// ================= DOM å…ƒç´  =================
const elements = {
  // ... ä¹‹å‰çš„å…ƒç´ å®šä¹‰ä¿æŒä¸å˜ ...
};

// ================= åˆå§‹åŒ– =================
document.addEventListener('DOMContentLoaded', function() {
  // åˆå§‹åŒ–è¡¨å•è¾“å…¥ç›‘å¬
  setupFormListeners();
  
  // åˆå§‹åŒ–æŒ‰é’®äº‹ä»¶
  elements.saveBtn.addEventListener('click', saveHealthData);
  elements.clearBtn.addEventListener('click', clearForm);
  elements.searchInput.addEventListener('input', filterUsers);
  
  // åˆå§‹åŒ–å›¾è¡¨
  initHealthChart();
  
  // æ˜¾ç¤ºç¤ºä¾‹æ•°æ®
  showSampleData();
  
  // åŠ è½½æœ¬åœ°å­˜å‚¨çš„æ•°æ®
  loadLocalData();
});

// ================= å¢å¼ºçš„è†³é£Ÿå»ºè®®åŠŸèƒ½ =================
function getDietPlan(age, bmi, gender) {
  const ageGroup = getAgeGroup(age);
  const bmiCategory = getBMICategory(bmi).type;
  const genderFactor = gender === 'female' ? 0.9 : 1.0; // å¥³æ€§åŸºç¡€ä»£è°¢è¾ƒä½
  
  // è®¡ç®—åŸºç¡€ä»£è°¢ç‡ (BMR)
  const bmr = calculateBMR(age, gender, bmi, genderFactor);
  
  // è®¡ç®—æ¯æ—¥æ€»èƒ½é‡æ¶ˆè€— (TDEE)
  const tdee = calculateTDEE(bmr, bmiCategory, ageGroup);
  
  // æ ¹æ®å¹´é¾„ã€BMIã€æ€§åˆ«ç”Ÿæˆä¸ªæ€§åŒ–è†³é£Ÿè®¡åˆ’
  return {
    dailyCalories: Math.round(tdee),
    bmr: Math.round(bmr),
    tdee: Math.round(tdee),
    mealPlan: generatePersonalizedMealPlan(ageGroup, bmiCategory, tdee, gender),
    nutritionGoals: getNutritionGoals(ageGroup, bmiCategory, gender),
    specialRecommendations: getSpecialRecommendations(ageGroup, bmiCategory, gender)
  };
}

function calculateBMR(age, gender, bmi, genderFactor) {
  // ä½¿ç”¨Mifflin-St Jeorå…¬å¼è®¡ç®—åŸºç¡€ä»£è°¢ç‡
  let bmr = 0;
  if (gender === 'male') {
    bmr = 10 * 70 + 6.25 * 170 - 5 * age + 5; // ä½¿ç”¨70kg, 170cmä½œä¸ºå‚è€ƒ
  } else {
    bmr = 10 * 60 + 6.25 * 160 - 5 * age - 161; // ä½¿ç”¨60kg, 160cmä½œä¸ºå‚è€ƒ
  }
  
  // æ ¹æ®BMIè°ƒæ•´
  if (bmi < 18.5) bmr *= 1.1; // åç˜¦éœ€è¦æ›´å¤šèƒ½é‡
  else if (bmi > 28) bmr *= 0.9; // è‚¥èƒ–éœ€è¦å‡å°‘èƒ½é‡
  
  return bmr * genderFactor;
}

function calculateTDEE(bmr, bmiCategory, ageGroup) {
  // åŸºç¡€æ´»åŠ¨ç³»æ•°
  let activityFactor = 1.375; // è½»åº¦æ´»åŠ¨
  
  // æ ¹æ®BMIè°ƒæ•´
  if (bmiCategory === 'obese') activityFactor = 1.2; // è‚¥èƒ–è€…å»ºè®®å‡å°‘æ´»åŠ¨å¼ºåº¦
  else if (bmiCategory === 'overweight') activityFactor = 1.55; // è¶…é‡è€…å»ºè®®å¢åŠ æ´»åŠ¨
  
  // æ ¹æ®å¹´é¾„è°ƒæ•´
  if (ageGroup === 'é’å°‘å¹´(<18)') activityFactor = 1.7; // é’å°‘å¹´æ´»åŠ¨é‡æ›´å¤§
  else if (ageGroup === 'è€å¹´(60+)') activityFactor = 1.2; // è€å¹´äººæ´»åŠ¨é‡è¾ƒå°
  
  return bmr * activityFactor;
}

function generatePersonalizedMealPlan(ageGroup, bmiCategory, tdee, gender) {
  const totalCalories = Math.round(tdee);
  const mealDistribution = getMealDistribution(ageGroup, bmiCategory);
  
  return {
    breakfast: generateMeal('breakfast', ageGroup, bmiCategory, totalCalories * mealDistribution.breakfast, gender),
    lunch: generateMeal('lunch', ageGroup, bmiCategory, totalCalories * mealDistribution.lunch, gender),
    dinner: generateMeal('dinner', ageGroup, bmiCategory, totalCalories * mealDistribution.dinner, gender),
    snacks: generateSnacks(ageGroup, bmiCategory, totalCalories * mealDistribution.snacks, gender)
  };
}

function getMealDistribution(ageGroup, bmiCategory) {
  // ä¸åŒäººç¾¤çš„é¤æ¬¡èƒ½é‡åˆ†é…
  const distributions = {
    'é’å°‘å¹´(<18)': { breakfast: 0.25, lunch: 0.35, dinner: 0.30, snacks: 0.10 },
    'é’å¹´(18-30)': { breakfast: 0.30, lunch: 0.40, dinner: 0.25, snacks: 0.05 },
    'ä¸­å¹´(31-45)': { breakfast: 0.30, lunch: 0.35, dinner: 0.30, snacks: 0.05 },
    'ä¸­è€å¹´(46-60)': { breakfast: 0.25, lunch: 0.35, dinner: 0.35, snacks: 0.05 },
    'è€å¹´(60+)': { breakfast: 0.30, lunch: 0.35, dinner: 0.30, snacks: 0.05 }
  };
  
  // æ ¹æ®BMIè°ƒæ•´
  if (bmiCategory === 'underweight') {
    // åç˜¦è€…å¢åŠ é›¶é£Ÿæ¯”ä¾‹
    return { breakfast: 0.25, lunch: 0.35, dinner: 0.30, snacks: 0.10 };
  } else if (bmiCategory === 'obese' || bmiCategory === 'overweight') {
    // è¶…é‡/è‚¥èƒ–è€…å‡å°‘æ™šé¤æ¯”ä¾‹
    return { breakfast: 0.30, lunch: 0.40, dinner: 0.25, snacks: 0.05 };
  }
  
  return distributions[ageGroup] || distributions['é’å¹´(18-30)'];
}

function generateMeal(mealType, ageGroup, bmiCategory, calories, gender) {
  const mealCalories = Math.round(calories);
  const foods = getFoodOptions(mealType, ageGroup, bmiCategory, gender);
  
  // æ™ºèƒ½é€‰æ‹©é£Ÿç‰©ç»„åˆ
  const selectedFoods = [];
  let remainingCalories = mealCalories;
  let proteinTarget = mealCalories * 0.25 / 4; // 25%è›‹ç™½è´¨
  let carbTarget = mealCalories * 0.50 / 4;   // 50%ç¢³æ°´
  let fatTarget = mealCalories * 0.25 / 9;    // 25%è„‚è‚ª
  
  // ä¼˜å…ˆé€‰æ‹©è›‹ç™½è´¨é£Ÿç‰©
  const proteinFoods = foods.filter(f => f.category === 'protein');
  if (proteinFoods.length > 0) {
    const food = getBestFood(proteinFoods, remainingCalories * 0.3);
    if (food) {
      selectedFoods.push(food);
      remainingCalories -= food.calories;
      proteinTarget -= food.protein || 0;
    }
  }
  
  // é€‰æ‹©ä¸»é£Ÿ
  const carbFoods = foods.filter(f => f.category === 'carb');
  if (carbFoods.length > 0) {
    const food = getBestFood(carbFoods, remainingCalories * 0.4);
    if (food) {
      selectedFoods.push(food);
      remainingCalories -= food.calories;
      carbTarget -= food.carbs || 0;
    }
  }
  
  // é€‰æ‹©è”¬èœæ°´æœ
  const veggieFoods = foods.filter(f => f.category === 'veggie');
  if (veggieFoods.length > 0) {
    const food = getBestFood(veggieFoods, remainingCalories * 0.2);
    if (food) {
      selectedFoods.push(food);
      remainingCalories -= food.calories;
    }
  }
  
  // å¦‚æœéœ€è¦ï¼Œæ·»åŠ é¢å¤–é£Ÿç‰©
  if (remainingCalories > 100) {
    const extraFoods = foods.filter(f => f.calories <= remainingCalories);
    if (extraFoods.length > 0) {
      const food = getBestFood(extraFoods, remainingCalories);
      if (food) {
        selectedFoods.push(food);
        remainingCalories -= food.calories;
      }
    }
  }
  
  return {
    totalCalories: mealCalories - remainingCalories,
    foods: selectedFoods,
    nutritionTips: getMealTips(mealType, ageGroup, bmiCategory, gender)
  };
}

function getFoodOptions(mealType, ageGroup, bmiCategory, gender) {
  // æ‰©å±•çš„é£Ÿç‰©æ•°æ®åº“
  const foodDatabase = {
    breakfast: [
      { name: 'ç‡•éº¦ç²¥ï¼ˆ1ç¢—ï¼‰', calories: 150, category: 'carb', protein: 5, carbs: 27, fat: 3, fiber: 4, note: 'é«˜çº¤ç»´ï¼Œç¼“æ…¢é‡Šæ”¾èƒ½é‡' },
      { name: 'å…¨éº¦é¢åŒ…ï¼ˆ2ç‰‡ï¼‰', calories: 160, category: 'carb', protein: 8, carbs: 30, fat: 2, fiber: 6, note: 'å¯Œå«Bæ—ç»´ç”Ÿç´ ' },
      { name: 'ç…®é¸¡è›‹ï¼ˆ2ä¸ªï¼‰', calories: 140, category: 'protein', protein: 12, carbs: 1, fat: 10, fiber: 0, note: 'ä¼˜è´¨è›‹ç™½è´¨' },
      { name: 'ç‰›å¥¶ï¼ˆ250mlï¼‰', calories: 150, category: 'protein', protein: 8, carbs: 12, fat: 8, fiber: 0, note: 'é’™è´¨ä¸°å¯Œ' },
      { name: 'å¸Œè…Šé…¸å¥¶ï¼ˆ150gï¼‰', calories: 100, category: 'protein', protein: 10, carbs: 6, fat: 3, fiber: 0, note: 'é«˜è›‹ç™½ä½è„‚' },
      { name: 'é¦™è•‰ï¼ˆ1æ ¹ï¼‰', calories: 105, category: 'carb', protein: 1, carbs: 27, fat: 0, fiber: 3, note: 'å¿«é€Ÿèƒ½é‡è¡¥å……' },
      { name: 'åšæœï¼ˆ30gï¼‰', calories: 180, category: 'fat', protein: 6, carbs: 6, fat: 16, fiber: 3, note: 'å¥åº·è„‚è‚ª' }
    ],
    lunch: [
      { name: 'ç³™ç±³é¥­ï¼ˆ1ç¢—ï¼‰', calories: 216, category: 'carb', protein: 5, carbs: 45, fat: 2, fiber: 4, note: 'å¯Œå«è†³é£Ÿçº¤ç»´' },
      { name: 'é¸¡èƒ¸è‚‰ï¼ˆ150gï¼‰', calories: 195, category: 'protein', protein: 44, carbs: 0, fat: 2, fiber: 0, note: 'ä¼˜è´¨è›‹ç™½è´¨' },
      { name: 'ä¸‰æ–‡é±¼ï¼ˆ150gï¼‰', calories: 312, category: 'protein', protein: 34, carbs: 0, fat: 20, fiber: 0, note: 'Omega-3è„‚è‚ªé…¸' },
      { name: 'è”¬èœæ²™æ‹‰ï¼ˆå¤§ç›˜ï¼‰', calories: 80, category: 'veggie', protein: 3, carbs: 12, fat: 0, fiber: 5, note: 'ç»´ç”Ÿç´ ä¸°å¯Œ' },
      { name: 'è±†è…ï¼ˆ150gï¼‰', calories: 120, category: 'protein', protein: 12, carbs: 4, fat: 7, fiber: 2, note: 'æ¤ç‰©è›‹ç™½' },
      { name: 'æ¸…è’¸é±¼ï¼ˆ150gï¼‰', calories: 180, category: 'protein', protein: 33, carbs: 0, fat: 5, fiber: 0, note: 'æ˜“æ¶ˆåŒ–è›‹ç™½' }
    ],
    dinner: [
      { name: 'è—œéº¦é¥­ï¼ˆ1ç¢—ï¼‰', calories: 220, category: 'carb', protein: 8, carbs: 39, fat: 4, fiber: 5, note: 'å®Œå…¨è›‹ç™½è´¨' },
      { name: 'ç˜¦ç‰›è‚‰ï¼ˆ150gï¼‰', calories: 250, category: 'protein', protein: 36, carbs: 0, fat: 10, fiber: 0, note: 'é“è´¨ä¸°å¯Œ' },
      { name: 'è’¸è”¬èœï¼ˆæ··åˆï¼‰', calories: 60, category: 'veggie', protein: 3, carbs: 10, fat: 0, fiber: 6, note: 'ä½çƒ­é‡é«˜çº¤ç»´' },
      { name: 'è˜‘è‡æ±¤ï¼ˆ1ç¢—ï¼‰', calories: 70, category: 'veggie', protein: 4, carbs: 8, fat: 3, fiber: 2, note: 'å¢å¼ºå…ç–«åŠ›' },
      { name: 'çƒ¤é¸¡è…¿ï¼ˆ1ä¸ªï¼‰', calories: 180, category: 'protein', protein: 28, carbs: 0, fat: 7, fiber: 0, note: 'ä¼˜è´¨è›‹ç™½' }
    ]
  };
  
  // æ ¹æ®æ¡ä»¶ç­›é€‰é£Ÿç‰©
  let foods = [...foodDatabase[mealType] || []];
  
  // æ ¹æ®BMIè°ƒæ•´
  if (bmiCategory === 'obese' || bmiCategory === 'overweight') {
    foods = foods.filter(f => f.calories < 200 || f.category === 'veggie');
  } else if (bmiCategory === 'underweight') {
    foods = foods.filter(f => f.calories > 100 && f.category !== 'veggie');
  }
  
  // æ ¹æ®å¹´é¾„æ®µè°ƒæ•´
  if (ageGroup === 'é’å°‘å¹´(<18)') {
    foods = foods.filter(f => f.note.includes('è›‹ç™½') || f.note.includes('é’™') || f.note.includes('çº¤ç»´'));
  } else if (ageGroup === 'è€å¹´(60+)') {
    foods = foods.filter(f => f.calories < 300 && (f.note.includes('æ˜“æ¶ˆåŒ–') || f.note.includes('è›‹ç™½')));
  }
  
  // æ ¹æ®æ€§åˆ«è°ƒæ•´
  if (gender === 'female') {
    // å¥³æ€§å¯èƒ½éœ€è¦æ›´å¤šé“è´¨
    foods = foods.map(f => {
      if (f.note.includes('é“')) f.priority = 1;
      return f;
    });
  }
  
  return foods;
}

function getBestFood(foods, maxCalories) {
  const suitableFoods = foods.filter(f => f.calories <= maxCalories);
  if (suitableFoods.length === 0) return null;
  
  // æŒ‰è›‹ç™½è´¨å«é‡å’Œçº¤ç»´å«é‡æ’åº
  return suitableFoods.sort((a, b) => {
    const scoreA = (a.protein || 0) + (a.fiber || 0);
    const scoreB = (b.protein || 0) + (b.fiber || 0);
    return scoreB - scoreA;
  })[0];
}

function generateSnacks(ageGroup, bmiCategory, calories, gender) {
  const snackCalories = Math.round(calories);
  const snacks = [
    { name: 'è‹¹æœï¼ˆä¸­ç­‰ï¼‰', calories: 95, note: 'å¯Œå«çº¤ç»´å’Œç»´ç”Ÿç´ C' },
    { name: 'æ ¸æ¡ƒï¼ˆ3ä¸ªï¼‰', calories: 100, note: 'Omega-3è„‚è‚ªé…¸ï¼Œæœ‰ç›Šå¿ƒè„' },
    { name: 'é…¸å¥¶ï¼ˆ100gï¼‰', calories: 60, note: 'ç›Šç”ŸèŒï¼ŒåŠ©æ¶ˆåŒ–' },
    { name: 'å…¨éº¦é¥¼å¹²ï¼ˆ2ç‰‡ï¼‰', calories: 70, note: 'ç¼“æ…¢é‡Šæ”¾èƒ½é‡' },
    { name: 'ç…®é¸¡è›‹ï¼ˆ1ä¸ªï¼‰', calories: 70, note: 'ä¼˜è´¨è›‹ç™½è´¨' },
    { name: 'èƒ¡èåœæ¡ï¼ˆ1å°ç¢—ï¼‰', calories: 50, note: 'å¯Œå«Î²-èƒ¡èåœç´ ' },
    { name: 'æä»ï¼ˆ10é¢—ï¼‰', calories: 70, note: 'ç»´ç”Ÿç´ Eï¼ŒæŠ—æ°§åŒ–' }
  ];
  
  // æ ¹æ®æ¡ä»¶ç­›é€‰é›¶é£Ÿ
  let filteredSnacks = [...snacks];
  
  if (bmiCategory === 'obese' || bmiCategory === 'overweight') {
    filteredSnacks = filteredSnacks.filter(s => s.calories < 80);
  } else if (bmiCategory === 'underweight') {
    filteredSnacks = filteredSnacks.filter(s => s.calories > 60);
  }
  
  if (ageGroup === 'é’å°‘å¹´(<18)') {
    filteredSnacks = filteredSnacks.filter(s => s.note.includes('è›‹ç™½') || s.note.includes('ç»´ç”Ÿç´ '));
  } else if (ageGroup === 'è€å¹´(60+)') {
    filteredSnacks = filteredSnacks.filter(s => s.note.includes('æ˜“æ¶ˆåŒ–') || s.note.includes('å¿ƒè„'));
  }
  
  // é€‰æ‹©2-3ç§é›¶é£Ÿ
  const selectedSnacks = [];
  let remainingCalories = snackCalories;
  
  while (remainingCalories > 50 && filteredSnacks.length > 0 && selectedSnacks.length < 3) {
    const suitableSnacks = filteredSnacks.filter(s => s.calories <= remainingCalories);
    if (suitableSnacks.length === 0) break;
    
    const snack = suitableSnacks[Math.floor(Math.random() * suitableSnacks.length)];
    selectedSnacks.push(snack);
    remainingCalories -= snack.calories;
    
    // ç§»é™¤å·²é€‰é›¶é£Ÿ
    const index = filteredSnacks.indexOf(snack);
    if (index > -1) filteredSnacks.splice(index, 1);
  }
  
  return {
    totalCalories: snackCalories - remainingCalories,
    snacks: selectedSnacks,
    tips: getSnackTips(ageGroup, bmiCategory)
  };
}

function getNutritionGoals(ageGroup, bmiCategory, gender) {
  const goals = {
    protein: { min: 0.8, max: 1.2, unit: 'g/kgä½“é‡' },
    carbs: { min: 3, max: 5, unit: 'g/kgä½“é‡' },
    fat: { min: 0.8, max: 1.2, unit: 'g/kgä½“é‡' },
    fiber: { min: 25, max: 35, unit: 'g/å¤©' },
    water: { min: 1500, max: 3000, unit: 'ml/å¤©' }
  };
  
  // æ ¹æ®BMIè°ƒæ•´
  if (bmiCategory === 'obese' || bmiCategory === 'overweight') {
    goals.protein.max = 1.5; // å¢åŠ è›‹ç™½è´¨
    goals.carbs.max = 3;    // å‡å°‘ç¢³æ°´
    goals.fat.max = 1.0;     // æ§åˆ¶è„‚è‚ª
  } else if (bmiCategory === 'underweight') {
    goals.protein.min = 1.2;
    goals.carbs.max = 6;    // å¢åŠ ç¢³æ°´
    goals.fat.max = 1.5;    // å¢åŠ å¥åº·è„‚è‚ª
  }
  
  // æ ¹æ®å¹´é¾„æ®µè°ƒæ•´
  if (ageGroup === 'é’å°‘å¹´(<18)') {
    goals.protein.max = 1.5;  // ç”Ÿé•¿å‘è‚²éœ€è¦
    goals.calcium = { min: 1000, max: 1300, unit: 'mg/å¤©' };
    goals.iron = { min: 8, max: 15, unit: 'mg/å¤©' };
  } else if (ageGroup === 'è€å¹´(60+)') {
    goals.protein.min = 1.0;  // é˜²æ­¢è‚Œè‚‰æµå¤±
    goals.calcium = { min: 1200, max: 1500, unit: 'mg/å¤©' };
    goals.vitaminD = { min: 800, max: 2000, unit: 'IU/å¤©' };
  }
  
  // æ ¹æ®æ€§åˆ«è°ƒæ•´
  if (gender === 'female') {
    goals.iron = { min: 18, max: 20, unit: 'mg/å¤©' };
  } else if (gender === 'male') {
    goals.zinc = { min: 11, max: 15, unit: 'mg/å¤©' };
  }
  
  return goals;
}

function getSpecialRecommendations(ageGroup, bmiCategory, gender) {
  const recommendations = [];
  
  // åŸºäºBMIçš„å»ºè®®
  if (bmiCategory === 'obese') {
    recommendations.push({
      icon: 'fas fa-weight',
      title: 'å‡é‡ç›®æ ‡',
      description: 'å»ºè®®æ¯å‘¨å‡é‡0.5-1kgï¼Œå¾ªåºæ¸è¿›',
      priority: 'high',
      tips: [
        'æ§åˆ¶æ¯æ—¥çƒ­é‡èµ¤å­—500-750å¤§å¡',
        'å¢åŠ æœ‰æ°§è¿åŠ¨è‡³æ¯å‘¨300åˆ†é’Ÿ',
        'è®°å½•é¥®é£Ÿæ—¥è®°ï¼Œæé«˜è‡ªæˆ‘ç›‘æ§'
      ]
    });
  } else if (bmiCategory === 'overweight') {
    recommendations.push({
      icon: 'fas fa-balance-scale',
      title: 'ä½“é‡æ§åˆ¶',
      description: 'ä¿æŒå¥åº·ä½“é‡ï¼Œé˜²æ­¢ç»§ç»­å¢åŠ ',
      priority: 'medium',
      tips: [
        'æ¯å‘¨ç›‘æµ‹ä½“é‡å˜åŒ–',
        'å¢åŠ è”¬èœæ‘„å…¥è‡³æ¯æ—¥500g',
        'å‡å°‘ç²¾åˆ¶ç³–å’ŒåŠ å·¥é£Ÿå“'
      ]
    });
  } else if (bmiCategory === 'underweight') {
    recommendations.push({
      icon: 'fas fa-utensil-spoon',
      title: 'è¥å…»å¢åŠ ',
      description: 'é€‚å½“å¢åŠ çƒ­é‡å’Œè›‹ç™½è´¨æ‘„å…¥',
      priority: 'high',
      tips: [
        'å¢åŠ å¥åº·é›¶é£Ÿï¼Œå¦‚åšæœã€é…¸å¥¶',
        'å°‘é‡å¤šé¤ï¼Œæ¯æ—¥5-6é¤',
        'å¢åŠ ä¼˜è´¨è›‹ç™½è´¨æ‘„å…¥'
      ]
    });
  }
  
  // åŸºäºå¹´é¾„æ®µçš„å»ºè®®
  if (ageGroup === 'é’å°‘å¹´(<18)') {
    recommendations.push({
      icon: 'fas fa-baby',
      title: 'ç”Ÿé•¿å‘è‚²',
      description: 'å…³é”®æ—¶æœŸï¼Œæ³¨é‡å…¨é¢è¥å…»',
      priority: 'high',
      tips: [
        'ä¿è¯æ¯æ—¥é’™è´¨1000-1300mg',
        'ä¼˜è´¨è›‹ç™½è´¨æ¯æ—¥1.5g/kgä½“é‡',
        'å……è¶³ç¡çœ 8-10å°æ—¶'
      ]
    });
  } else if (ageGroup === 'ä¸­å¹´(31-45)') {
    recommendations.push({
      icon: 'fas fa-heartbeat',
      title: 'ä»£è°¢ç®¡ç†',
      description: 'é¢„é˜²ä»£è°¢ç»¼åˆå¾',
      priority: 'medium',
      tips: [
        'å®šæœŸç›‘æµ‹è¡€å‹ã€è¡€ç³–ã€è¡€è„‚',
        'æ§åˆ¶è…°å›´<90cm(ç”·)/85cm(å¥³)',
        'å¢åŠ è†³é£Ÿçº¤ç»´æ‘„å…¥'
      ]
    });
  } else if (ageGroup === 'è€å¹´(60+)') {
    recommendations.push({
      icon: 'fas fa-bone',
      title: 'éª¨éª¼å¥åº·',
      description: 'é¢„é˜²éª¨è´¨ç–æ¾å’Œè‚Œè‚‰æµå¤±',
      priority: 'high',
      tips: [
        'è¡¥å……ç»´ç”Ÿç´ D 800-2000IU/å¤©',
        'è›‹ç™½è´¨æ¯æ—¥1.0-1.2g/kgä½“é‡',
        'é€‚å½“åŠ›é‡è®­ç»ƒé¢„é˜²è‚Œå°‘ç—‡'
      ]
    });
  }
  
  // åŸºäºæ€§åˆ«çš„å»ºè®®
  if (gender === 'female') {
    recommendations.push({
      icon: 'fas fa-venus',
      title: 'å¥³æ€§å¥åº·',
      description: 'ç‰¹åˆ«å…³æ³¨é“è´¨å’Œé’™è´¨',
      priority: 'medium',
      tips: [
        'æœˆç»æœŸé¢å¤–è¡¥å……é“è´¨',
        'æ¯æ—¥é’™è´¨æ‘„å…¥1000-1200mg',
        'æ³¨æ„å¶é…¸æ‘„å…¥ï¼ˆå¤‡å­•ï¼‰'
      ]
    });
  } else if (gender === 'male') {
    recommendations.push({
      icon: 'fas fa-mars',
      title: 'ç”·æ€§å¥åº·',
      description: 'å…³æ³¨å¿ƒè„å’Œå‰åˆ—è…ºå¥åº·',
      priority: 'medium',
      tips: [
        'æ§åˆ¶çº¢è‚‰æ‘„å…¥ï¼Œå¢åŠ é±¼ç±»',
        'å¢åŠ ç•ªèŒ„ã€è¥¿å…°èŠ±æ‘„å…¥',
        'é™åˆ¶é…’ç²¾æ‘„å…¥'
      ]
    });
  }
  
  return recommendations;
}

function getMealTips(mealType, ageGroup, bmiCategory, gender) {
  const tips = [];
  
  if (mealType === 'breakfast') {
    tips.push('æ—©é¤åº”åœ¨èµ·åºŠå1å°æ—¶å†…é£Ÿç”¨');
    tips.push('ä¿è¯è›‹ç™½è´¨æ‘„å…¥ï¼Œå»¶ç¼“é¥¥é¥¿æ„Ÿ');
    
    if (bmiCategory === 'obese' || bmiCategory === 'overweight') {
      tips.push('é¿å…é«˜ç³–æ—©é¤ï¼Œé€‰æ‹©é«˜çº¤ç»´é£Ÿç‰©');
    }
    if (ageGroup === 'é’å°‘å¹´(<18)') {
      tips.push('é’å°‘å¹´éœ€è¦å……è¶³èƒ½é‡ï¼Œæ—©é¤è¦ä¸°ç››');
    }
  } else if (mealType === 'lunch') {
    tips.push('åˆé¤åº”åŒ…å«è›‹ç™½è´¨ã€ç¢³æ°´ã€è”¬èœ');
    tips.push('åˆé¤åé€‚å½“æ´»åŠ¨ï¼Œå¸®åŠ©æ¶ˆåŒ–');
    
    if (bmiCategory === 'underweight') {
      tips.push('å¯é€‚å½“å¢åŠ ä¸»é£Ÿå’Œè›‹ç™½è´¨æ‘„å…¥');
    }
  } else if (mealType === 'dinner') {
    tips.push('æ™šé¤å®œæ¸…æ·¡ï¼Œæ§åˆ¶åœ¨ç¡å‰3å°æ—¶å®Œæˆ');
    tips.push('å‡å°‘ä¸»é£Ÿï¼Œå¢åŠ è”¬èœæ¯”ä¾‹');
    
    if (ageGroup === 'è€å¹´(60+)') {
      tips.push('æ™šé¤å®œå°‘é‡ï¼Œå‡è½»è‚ èƒƒè´Ÿæ‹…');
    }
  }
  
  return tips;
}

function getSnackTips(ageGroup, bmiCategory) {
  const tips = [];
  
  if (bmiCategory === 'obese' || bmiCategory === 'overweight') {
    tips.push('é€‰æ‹©ä½çƒ­é‡ã€é«˜çº¤ç»´çš„é›¶é£Ÿ');
    tips.push('æ§åˆ¶ä»½é‡ï¼Œé¿å…æ— æ„è¯†è¿›é£Ÿ');
  } else if (bmiCategory === 'underweight') {
    tips.push('é€‰æ‹©è¥å…»å¯†åº¦é«˜çš„å¥åº·é›¶é£Ÿ');
    tips.push('å¯åœ¨ä¸¤é¤ä¹‹é—´åŠ é¤');
  }
  
  if (ageGroup === 'é’å°‘å¹´(<18)') {
    tips.push('è¯¾é—´å¯è¡¥å……æ°´æœã€é…¸å¥¶ç­‰');
  } else if (ageGroup === 'è€å¹´(60+)') {
    tips.push('é€‰æ‹©æ˜“æ¶ˆåŒ–ã€è½¯è´¨çš„é›¶é£Ÿ');
  }
  
  return tips;
}

// ================= å¢å¼ºçš„åŒé¾„äººåˆ†æ =================
function getPeerHealthAnalysis(ageGroup, bmiCategory, allUsers) {
  const peerUsers = allUsers.filter(user => {
    const userAgeGroup = getAgeGroup(user.age);
    return userAgeGroup === ageGroup;
  });
  
  if (peerUsers.length === 0) {
    return getDefaultPeerAnalysis(ageGroup, bmiCategory);
  }
  
  // è®¡ç®—ç»Ÿè®¡æ•°æ®
  const stats = calculatePeerStats(peerUsers);
  const commonIssues = analyzeCommonIssues(peerUsers, bmiCategory);
  const recommendations = generatePeerRecommendations(stats, commonIssues, ageGroup, bmiCategory);
  
  return {
    peerCount: peerUsers.length,
    stats: stats,
    commonIssues: commonIssues,
    recommendations: recommendations,
    successStories: getSuccessStories(peerUsers, bmiCategory),
    warningSigns: getWarningSigns(stats, ageGroup)
  };
}

function calculatePeerStats(peerUsers) {
  const bmis = peerUsers.map(u => parseFloat(u.bmi) || 0).filter(b => b > 0);
  const ages = peerUsers.map(u => parseInt(u.age) || 0).filter(a => a > 0);
  
  if (bmis.length === 0) return {};
  
  const avgBMI = (bmis.reduce((a, b) => a + b, 0) / bmis.length).toFixed(1);
  const maxBMI = Math.max(...bmis).toFixed(1);
  const minBMI = Math.min(...bmis).toFixed(1);
  
  // BMIåˆ†å¸ƒ
  const bmiDistribution = {
    underweight: bmis.filter(b => b < 18.5).length,
    normal: bmis.filter(b => b >= 18.5 && b < 24).length,
    overweight: bmis.filter(b => b >= 24 && b < 28).length,
    obese: bmis.filter(b => b >= 28).length
  };
  
  // å¹´é¾„æ®µåˆ†å¸ƒ
  const ageDistribution = {
    teen: ages.filter(a => a < 18).length,
    young: ages.filter(a => a >= 18 && a <= 30).length,
    middle: ages.filter(a => a > 30 && a <= 45).length,
    senior: ages.filter(a => a > 45 && a <= 60).length,
    elderly: ages.filter(a => a > 60).length
  };
  
  return {
    avgBMI,
    maxBMI,
    minBMI,
    bmiDistribution,
    ageDistribution,
    totalUsers: peerUsers.length,
    avgAge: ages.length > 0 ? Math.round(ages.reduce((a, b) => a + b, 0) / ages.length) : 0
  };
}

function analyzeCommonIssues(peerUsers, currentBMICategory) {
  const issues = [];
  const stats = calculatePeerStats(peerUsers);
  
  // åˆ†æå¸¸è§é—®é¢˜
  if (stats.bmiDistribution.overweight + stats.bmiDistribution.obese > stats.totalUsers * 0.4) {
    issues.push({
      type: 'weight',
      severity: 'high',
      title: 'æ™®éè¶…é‡é—®é¢˜',
      description: `${Math.round((stats.bmiDistribution.overweight + stats.bmiDistribution.obese) / stats.totalUsers * 100)}%çš„åŒé¾„äººå­˜åœ¨è¶…é‡æˆ–è‚¥èƒ–é—®é¢˜`,
      suggestions: ['å¢åŠ æœ‰æ°§è¿åŠ¨', 'æ§åˆ¶ç¢³æ°´åŒ–åˆç‰©æ‘„å…¥', 'å‡å°‘åŠ å·¥é£Ÿå“']
    });
  }
  
  if (stats.avgBMI < 20 && currentBMICategory !== 'underweight') {
    issues.push({
      type: 'underweight',
      severity: 'medium',
      title: 'ä½“é‡åä½ç°è±¡',
      description: 'åŒé¾„äººå¹³å‡BMIåä½ï¼Œéœ€è¦æ³¨æ„è¥å…»æ‘„å…¥',
      suggestions: ['å¢åŠ ä¼˜è´¨è›‹ç™½è´¨', 'å°‘é‡å¤šé¤', 'é€‚å½“å¢åŠ å¥åº·è„‚è‚ª']
    });
  }
  
  // æ ¹æ®å½“å‰BMIç»™å‡ºå»ºè®®
  if (currentBMICategory === 'obese' && stats.bmiDistribution.normal > stats.totalUsers * 0.5) {
    issues.push({
      type: 'improvement',
      severity: 'info',
      title: 'æ”¹å–„ç©ºé—´è¾ƒå¤§',
      description: 'è¶…è¿‡ä¸€åŠçš„åŒé¾„äººBMIæ­£å¸¸ï¼Œæœ‰æˆåŠŸç»éªŒå¯å€Ÿé‰´',
      suggestions: ['å­¦ä¹ å¥åº·é¥®é£Ÿæ¨¡å¼', 'å’¨è¯¢è¥å…»å¸ˆåˆ¶å®šè®¡åˆ’', 'åŠ å…¥å‡é‡å°ç»„äº’åŠ©']
    });
  }
  
  return issues;
}

function generatePeerRecommendations(stats, commonIssues, ageGroup, bmiCategory) {
  const recommendations = [];
  
  // åŸºäºç»Ÿè®¡æ•°æ®çš„å»ºè®®
  if (stats.avgBMI && stats.avgBMI > 24) {
    recommendations.push({
      category: 'weight',
      priority: 'high',
      title: 'ä½“é‡ç®¡ç†',
      description: `åŒé¾„äººå¹³å‡BMIä¸º${stats.avgBMI}ï¼Œç•¥é«˜äºå¥åº·èŒƒå›´`,
      details: [
        'æ§åˆ¶æ¯æ—¥çƒ­é‡æ‘„å…¥ï¼Œåˆ›é€ é€‚é‡çƒ­é‡ç¼ºå£',
        'å¢åŠ è†³é£Ÿçº¤ç»´æ‘„å…¥ï¼Œæé«˜é¥±è…¹æ„Ÿ',
        'æ¯å‘¨è‡³å°‘150åˆ†é’Ÿä¸­ç­‰å¼ºåº¦æœ‰æ°§è¿åŠ¨',
        'è®°å½•é¥®é£Ÿæ—¥è®°ï¼Œæé«˜è‡ªæˆ‘ç›‘æ§æ„è¯†'
      ],
      successRate: '70%',
      timeFrame: '3-6ä¸ªæœˆå¯è§æ˜æ˜¾æ•ˆæœ'
    });
  }
  
  // åŸºäºå¸¸è§é—®é¢˜çš„å»ºè®®
  commonIssues.forEach(issue => {
    if (issue.severity === 'high') {
      recommendations.push({
        category: issue.type,
        priority: 'high',
        title: issue.title,
        description: issue.description,
        details: issue.suggestions,
        successRate: '85%',
        timeFrame: 'åšæŒ4å‘¨å½¢æˆä¹ æƒ¯'
      });
    }
  });
  
  // åŸºäºå¹´é¾„æ®µçš„å»ºè®®
  const ageRecommendations = getAgeSpecificRecommendations(ageGroup, bmiCategory);
  recommendations.push(...ageRecommendations);
  
  // åŸºäºBMIçš„å»ºè®®
  const bmiRecommendations = getBMIRecommendations(bmiCategory, stats);
  recommendations.push(...bmiRecommendations);
  
  return recommendations;
}

function getAgeSpecificRecommendations(ageGroup, bmiCategory) {
  const recommendations = [];
  
  switch(ageGroup) {
    case 'é’å°‘å¹´(<18)':
      recommendations.push({
        category: 'growth',
        priority: 'high',
        title: 'ç”Ÿé•¿å‘è‚²æ”¯æŒ',
        description: 'é’æ˜¥æœŸæ˜¯å…³é”®å‘è‚²æœŸï¼Œéœ€è¦å……è¶³è¥å…»',
        details: [
          'æ¯æ—¥ä¿è¯500mlç‰›å¥¶æˆ–åŒç­‰é’™è´¨',
          'ä¼˜è´¨è›‹ç™½æ‘„å…¥1.2-1.6g/kgä½“é‡',
          'é“è´¨è¡¥å……ï¼Œç‰¹åˆ«æ˜¯é’æ˜¥æœŸå¥³æ€§',
          'ç»´ç”Ÿç´ Dè¡¥å……ï¼Œä¿ƒè¿›é’™å¸æ”¶',
          'å……è¶³ç¡çœ 8-10å°æ—¶/å¤©'
        ],
        successRate: '90%',
        timeFrame: 'æŒç»­æ•´ä¸ªé’æ˜¥æœŸ'
      });
      break;
      
    case 'é’å¹´(18-30)':
      recommendations.push({
        category: 'habit',
        priority: 'medium',
        title: 'å»ºç«‹å¥åº·ä¹ æƒ¯',
        description: 'é’å¹´æœŸæ˜¯å»ºç«‹ç»ˆèº«å¥åº·ä¹ æƒ¯çš„å…³é”®æœŸ',
        details: [
          'è§„å¾‹ä¸‰é¤ï¼Œé¿å…é•¿æœŸå¤–å–',
          'æ¯å‘¨3-5æ¬¡è¿åŠ¨ï¼Œä¿æŒæ´»åŠ›',
          'æ§åˆ¶é…’ç²¾æ‘„å…¥ï¼Œé¿å…çƒŸé…’',
          'å»ºç«‹è§„å¾‹ä½œæ¯ï¼Œä¿è¯ç¡çœ ',
          'å­¦ä¹ è¥å…»çŸ¥è¯†ï¼Œç§‘å­¦é¥®é£Ÿ'
        ],
        successRate: '80%',
        timeFrame: '21å¤©å½¢æˆä¹ æƒ¯'
      });
      break;
      
    case 'ä¸­å¹´(31-45)':
      recommendations.push({
        category: 'metabolism',
        priority: 'high',
        title: 'ä»£è°¢ç®¡ç†',
        description: 'æ–°é™ˆä»£è°¢å¼€å§‹ä¸‹é™ï¼Œéœ€è¦è°ƒæ•´é¥®é£Ÿç»“æ„',
        details: [
          'æ§åˆ¶çƒ­é‡æ‘„å…¥ï¼Œé˜²æ­¢ä¸­å¹´å‘ç¦',
          'å¢åŠ è›‹ç™½è´¨æ¯”ä¾‹ï¼Œç»´æŒè‚Œè‚‰é‡',
          'å‡å°‘ç²¾åˆ¶ç¢³æ°´ï¼Œå¢åŠ å…¨è°·ç‰©',
          'å®šæœŸä½“æ£€ï¼Œç›‘æµ‹ä¸‰é«˜æŒ‡æ ‡',
          'å‹åŠ›ç®¡ç†ï¼Œé¿å…æƒ…ç»ªæ€§è¿›é£Ÿ'
        ],
        successRate: '75%',
        timeFrame: '3ä¸ªæœˆè°ƒæ•´æœŸ'
      });
      break;
      
    case 'ä¸­è€å¹´(46-60)':
      recommendations.push({
        category: 'prevention',
        priority: 'high',
        title: 'æ…¢ç—…é¢„é˜²',
        description: 'é¢„é˜²æ…¢æ€§ç–¾ç—…çš„å…³é”®æ—¶æœŸ',
        details: [
          'ä½ç›ä½è„‚é¥®é£Ÿï¼Œæ§åˆ¶è¡€å‹è¡€è„‚',
          'å¢åŠ è†³é£Ÿçº¤ç»´ï¼Œé¢„é˜²ä¾¿ç§˜',
          'è¡¥å……é’™è´¨å’Œç»´ç”Ÿç´ D',
          'é€‚å½“åŠ›é‡è®­ç»ƒï¼Œé¢„é˜²è‚Œå°‘ç—‡',
          'å®šæœŸä½“æ£€ï¼Œæ—©æœŸå‘ç°é—®é¢˜'
        ],
        successRate: '85%',
        timeFrame: 'é•¿æœŸåšæŒ'
      });
      break;
      
    case 'è€å¹´(60+)':
      recommendations.push({
        category: 'aging',
        priority: 'high',
        title: 'å¥åº·è€é¾„åŒ–',
        description: 'ç»´æŒåŠŸèƒ½ï¼Œæé«˜ç”Ÿæ´»è´¨é‡',
        details: [
          'ä¼˜è´¨è›‹ç™½æ‘„å…¥ï¼Œé˜²æ­¢è‚Œè‚‰æµå¤±',
          'æ˜“æ¶ˆåŒ–é£Ÿç‰©ï¼Œå°‘é‡å¤šé¤',
          'å……è¶³æ°´åˆ†ï¼Œé¢„é˜²è„±æ°´',
          'é€‚å½“æ´»åŠ¨ï¼Œç»´æŒå…³èŠ‚çµæ´»æ€§',
          'ç¤¾äº¤æ´»åŠ¨ï¼Œå¿ƒç†å¥åº·é‡è¦'
        ],
        successRate: '80%',
        timeFrame: 'æŒç»­æ”¹å–„'
      });
      break;
  }
  
  return recommendations;
}

function getBMIRecommendations(bmiCategory, stats) {
  const recommendations = [];
  
  switch(bmiCategory) {
    case 'underweight':
      recommendations.push({
        category: 'weight_gain',
        priority: 'high',
        title: 'å¥åº·å¢é‡è®¡åˆ’',
        description: 'ç§‘å­¦å¢åŠ ä½“é‡ï¼Œæ”¹å–„è¥å…»çŠ¶å†µ',
        details: [
          'æ¯æ—¥å¢åŠ 300-500å¤§å¡çƒ­é‡',
          'å¢åŠ ä¼˜è´¨è›‹ç™½æ‘„å…¥ï¼ˆ1.2-1.5g/kgï¼‰',
          'é€‰æ‹©å¥åº·è„‚è‚ªï¼Œå¦‚åšæœã€ç‰›æ²¹æœ',
          'åŠ›é‡è®­ç»ƒä¿ƒè¿›è‚Œè‚‰å¢é•¿',
          'è®°å½•ä½“é‡å˜åŒ–ï¼Œæ¯å‘¨å¢åŠ 0.5kg'
        ],
        successRate: '70%',
        timeFrame: '3ä¸ªæœˆå¢é‡ç›®æ ‡'
      });
      break;
      
    case 'normal':
      recommendations.push({
        category: 'maintenance',
        priority: 'medium',
        title: 'ä½“é‡ç»´æŒç­–ç•¥',
        description: 'ä¿æŒå¥åº·ä½“é‡ï¼Œé¢„é˜²åå¼¹',
        details: [
          'å‡è¡¡é¥®é£Ÿï¼Œæ§åˆ¶æ€»çƒ­é‡',
          'å®šæœŸç›‘æµ‹ä½“é‡ï¼ŒåŠæ—¶è°ƒæ•´',
          'ä¿æŒè¿åŠ¨ä¹ æƒ¯ï¼Œæ¯å‘¨150åˆ†é’Ÿ',
          'æ³¨æ„é¥®é£Ÿè´¨é‡ï¼Œè€Œéæ•°é‡',
          'åº”å¯¹å‹åŠ›ï¼Œé¿å…æƒ…ç»ªè¿›é£Ÿ'
        ],
        successRate: '85%',
        timeFrame: 'é•¿æœŸç»´æŒ'
      });
      break;
      
    case 'overweight':
      recommendations.push({
        category: 'weight_loss',
        priority: 'high',
        title: 'ç§‘å­¦å‡é‡æ–¹æ¡ˆ',
        description: 'å®‰å…¨æœ‰æ•ˆåœ°å‡è½»ä½“é‡',
        details: [
          'æ¯æ—¥çƒ­é‡èµ¤å­—500å¤§å¡',
          'æ§åˆ¶ç¢³æ°´ï¼Œå¢åŠ è›‹ç™½è´¨æ¯”ä¾‹',
          'æœ‰æ°§+åŠ›é‡è®­ç»ƒç»“åˆ',
          'å……è¶³ç¡çœ ï¼Œå‡å°‘å‹åŠ›',
          'å¯»æ±‚ä¸“ä¸šæŒ‡å¯¼ï¼Œé¿å…æç«¯èŠ‚é£Ÿ'
        ],
        successRate: '75%',
        timeFrame: 'æ¯å‘¨å‡é‡0.5-1kg'
      });
      break;
      
    case 'obese':
      recommendations.push({
        category: 'medical',
        priority: 'high',
        title: 'åŒ»å­¦å‡é‡å»ºè®®',
        description: 'è‚¥èƒ–éœ€è¦åŒ»å­¦å¹²é¢„å’Œé•¿æœŸç®¡ç†',
        details: [
          'å’¨è¯¢åŒ»ç”Ÿæˆ–è¥å…»å¸ˆåˆ¶å®šä¸ªæ€§åŒ–æ–¹æ¡ˆ',
          'å¯èƒ½éœ€è¦åŒ»å­¦ç›‘æµ‹ä¸‹çš„ä½çƒ­é‡é¥®é£Ÿ',
          'ç»“åˆè¯ç‰©æ²»ç–—ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰',
          'å¿ƒç†æ”¯æŒï¼Œåº”å¯¹é¥®é£Ÿæƒ…ç»ª',
          'æ”¯æŒå°ç»„ï¼Œé•¿æœŸè¡Œä¸ºæ”¹å˜'
        ],
        successRate: '60%',
        timeFrame: '6-12ä¸ªæœˆå‡é‡ç›®æ ‡'
      });
      break;
  }
  
  return recommendations;
}

function getSuccessStories(peerUsers, currentBMICategory) {
  const successUsers = peerUsers.filter(user => {
    const userCategory = getBMICategory(parseFloat(user.bmi)).type;
    return userCategory === 'normal' || (currentBMICategory !== 'normal' && userCategory === 'normal');
  }).slice(0, 3); // æœ€å¤šå–3ä¸ªæˆåŠŸæ¡ˆä¾‹
  
  return successUsers.map(user => ({
    name: user.name || 'åŒ¿åç”¨æˆ·',
    age: user.age,
    bmi: user.bmi,
    duration: '3-6ä¸ªæœˆ',
    strategy: getSuccessStrategy(user),
    result: getSuccessResult(user)
  }));
}

function getSuccessStrategy(user) {
  const strategies = [
    'é‡‡ç”¨åœ°ä¸­æµ·é¥®é£Ÿæ¨¡å¼ï¼Œå¢åŠ æ©„æ¦„æ²¹å’Œé±¼ç±»æ‘„å…¥',
    'åšæŒæ¯æ—¥æ­¥è¡Œ10000æ­¥ï¼Œé…åˆæ¯å‘¨3æ¬¡åŠ›é‡è®­ç»ƒ',
    'é‡‡ç”¨é—´æ­‡æ€§æ–­é£Ÿï¼Œæ§åˆ¶è¿›é£Ÿæ—¶é—´çª—å£',
    'è®°å½•é¥®é£Ÿæ—¥è®°ï¼Œæé«˜è‡ªæˆ‘ç›‘æ§æ„è¯†',
    'åŠ å…¥çº¿ä¸Šå¥åº·ç¤¾ç¾¤ï¼Œäº’ç›¸ç›‘ç£é¼“åŠ±'
  ];
  return strategies[Math.floor(Math.random() * strategies.length)];
}

function getSuccessResult(user) {
  const bmi = parseFloat(user.bmi);
  if (bmi < 24) return 'æˆåŠŸç»´æŒå¥åº·ä½“é‡';
  if (bmi < 28) return 'æˆåŠŸå‡é‡5-10kgï¼ŒBMIæ¢å¤æ­£å¸¸';
  return 'æˆåŠŸå‡é‡10kgä»¥ä¸Šï¼Œå¥åº·çŠ¶å†µæ˜¾è‘—æ”¹å–„';
}

function getWarningSigns(stats, ageGroup) {
  const warnings = [];
  
  if (stats.avgBMI > 26) {
    warnings.push({
      type: 'high_bmi',
      level: 'high',
      message: `åŒé¾„äººå¹³å‡BMI ${stats.avgBMI}ï¼Œè¶…è¿‡å¥åº·èŒƒå›´`,
      action: 'å»ºè®®è¿›è¡Œå¥åº·æ£€æŸ¥å’Œç”Ÿæ´»æ–¹å¼è°ƒæ•´'
    });
  }
  
  if (stats.bmiDistribution.obese > stats.totalUsers * 0.3) {
    warnings.push({
      type: 'obesity_rate',
      level: 'high',
      message: `${Math.round(stats.bmiDistribution.obese / stats.totalUsers * 100)}%çš„åŒé¾„äººå±äºè‚¥èƒ–`,
      action: 'éœ€è¦ç¾¤ä½“æ€§å¥åº·å¹²é¢„'
    });
  }
  
  // å¹´é¾„æ®µç‰¹å®šè­¦å‘Š
  if (ageGroup === 'ä¸­å¹´(31-45)' && stats.avgBMI > 24) {
    warnings.push({
      type: 'middle_age_weight',
      level: 'medium',
      message: 'ä¸­å¹´å‘ç¦ç°è±¡æ˜æ˜¾ï¼Œéœ€ç‰¹åˆ«å…³æ³¨',
      action: 'åŠ å¼ºä»£è°¢ç®¡ç†ï¼Œé˜²æ­¢ç»§ç»­å¢é‡'
    });
  }
  
  return warnings;
}

function getDefaultPeerAnalysis(ageGroup, bmiCategory) {
  // å½“æ²¡æœ‰åŒé¾„äººæ•°æ®æ—¶ï¼Œè¿”å›é»˜è®¤åˆ†æ
  return {
    peerCount: 0,
    stats: {
      avgBMI: 'æš‚æ— æ•°æ®',
      totalUsers: 0
    },
    commonIssues: [],
    recommendations: getAgeSpecificRecommendations(ageGroup, bmiCategory),
    successStories: [],
    warningSigns: []
  };
}

// ================= UIæ›´æ–°å‡½æ•° =================
function showEnhancedDietAdvice(data) {
  const dietPlan = getDietPlan(data.age, data.bmi, data.gender);
  const ageGroup = getAgeGroup(data.age);
  const bmiCategory = getBMICategory(data.bmi).type;
  
  // æ›´æ–°æ€»çƒ­é‡æ˜¾ç¤º
  elements.dailyCalories.textContent = `å»ºè®®æ€»çƒ­é‡: ${dietPlan.dailyCalories} kcal`;
  
  // ç”Ÿæˆè¯¦ç»†çš„è†³é£Ÿå»ºè®®HTML
  let html = `
    <div style="margin-bottom: 20px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
        <h3 style="font-size: 1.1rem; color: var(--primary);">ä¸ªæ€§åŒ–è†³é£Ÿè®¡åˆ’</h3>
        <div style="font-size: 0.9rem; color: var(--muted);">
          <div>BMR: <strong>${dietPlan.bmr}</strong> kcal</div>
          <div>TDEE: <strong>${dietPlan.tdee}</strong> kcal</div>
        </div>
      </div>
      
      <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(210, 82, 140, 0.1)); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
        <h4 style="color: var(--primary); margin-bottom: 12px;">ğŸ½ï¸ é¤æ¬¡åˆ†é…</h4>
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; text-align: center;">
          <div>
            <div style="font-size: 1.2rem; font-weight: 600; color: var(--primary);">æ—©é¤</div>
            <div style="font-size: 0.9rem; color: var(--muted);">${Math.round(dietPlan.mealPlan.breakfast.totalCalories)} kcal</div>
          </div>
          <div>
            <div style="font-size: 1.2rem; font-weight: 600; color: var(--success);">åˆé¤</div>
            <div style="font-size: 0.9rem; color: var(--muted);">${Math.round(dietPlan.mealPlan.lunch.totalCalories)} kcal</div>
          </div>
          <div>
            <div style="font-size: 1.2rem; font-weight: 600; color: var(--warning);">æ™šé¤</div>
            <div style="font-size: 0.9rem; color: var(--muted);">${Math.round(dietPlan.mealPlan.dinner.totalCalories)} kcal</div>
          </div>
          <div>
            <div style="font-size: 1.2rem; font-weight: 600; color: var(--info);">åŠ é¤</div>
            <div style="font-size: 0.9rem; color: var(--muted);">${Math.round(dietPlan.mealPlan.snacks.totalCalories)} kcal</div>
          </div>
        </div>
      </div>
  `;
  
  // æ—©é¤å»ºè®®
  html += `
    <div style="margin-bottom: 20px; padding: 16px; border: 1px solid rgba(0,0,0,0.1); border-radius: 12px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
        <h4 style="font-size: 1.1rem; color: var(--primary);">ğŸŒ… æ—©é¤å»ºè®®</h4>
        <span style="background: linear-gradient(135deg, var(--primary), var(--primary-light)); color: white; padding: 4px 12px; border-radius: 999px; font-size: 0.9rem;">
          ${dietPlan.mealPlan.breakfast.totalCalories} kcal
        </span>
      </div>
  `;
  
  dietPlan.mealPlan.breakfast.foods.forEach(food => {
    html += `
      <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px dashed var(--border);">
        <div>
          <div style="font-weight: 500;">${food.name}</div>
          <div style="font-size: 0.85rem; color: var(--muted);">${food.note}</div>
        </div>
        <div style="text-align: right;">
          <div style="font-weight: 600; color: var(--primary);">${food.calories} kcal</div>
          <div style="font-size: 0.8rem; color: var(--muted);">P:${food.protein || 0}g | C:${food.carbs || 0}g | F:${food.fat || 0}g</div>
        </div>
      </div>
    `;
  });
  
  if (dietPlan.mealPlan.breakfast.tips && dietPlan.mealPlan.breakfast.tips.length > 0) {
    html += `
      <div style="margin-top: 12px; padding: 12px; background: rgba(72, 187, 120, 0.1); border-radius: 8px;">
        <div style="font-size: 0.9rem; color: var(--success); font-weight: 500; margin-bottom: 4px;">ğŸ’¡ å»ºè®®ï¼š</div>
        <ul style="margin: 0; padding-left: 20px; font-size: 0.85rem; color: var(--dark);">
          ${dietPlan.mealPlan.breakfast.tips.map(tip => `<li>${tip}</li>`).join('')}
        </ul>
      </div>
    `;
  }
  
  html += '</div>';
  
  // è¥å…»ç›®æ ‡
  html += `
    <div style="margin-bottom: 20px; padding: 16px; border: 1px solid rgba(0,0,0,0.1); border-radius: 12px;">
      <h4 style="font-size: 1.1rem; color: var(--primary); margin-bottom: 12px;">ğŸ¯ è¥å…»ç›®æ ‡</h4>
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
  `;
  
  Object.entries(dietPlan.nutritionGoals).forEach(([key, goal]) => {
    html += `
      <div style="padding: 8px; border-radius: 8px; background: rgba(0,0,0,0.02);">
        <div style="font-weight: 500; font-size: 0.9rem;">${getNutritionName(key)}</div>
        <div style="font-size: 0.8rem; color: var(--muted);">${goal.min} - ${goal.max} ${goal.unit}</div>
      </div>
    `;
  });
  
  html += `
      </div>
    </div>
  `;
  
  // ç‰¹åˆ«å»ºè®®
  if (dietPlan.specialRecommendations.length > 0) {
    html += `
      <div style="margin-bottom: 20px; padding: 16px; border: 1px solid rgba(0,0,0,0.1); border-radius: 12px;">
        <h4 style="font-size: 1.1rem; color: var(--primary); margin-bottom: 12px;">ğŸ’¡ ç‰¹åˆ«å»ºè®®</h4>
    `;
    
    dietPlan.specialRecommendations.forEach(rec => {
      const priorityColor = rec.priority === 'high' ? 'var(--danger)' : 'var(--warning)';
      html += `
        <div style="margin-bottom: 12px; padding: 12px; background: ${rec.priority === 'high' ? 'rgba(245, 101, 101, 0.1)' : 'rgba(237, 137, 54, 0.1)'}; border-radius: 8px;">
          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
            <i class="${rec.icon}" style="color: ${priorityColor};"></i>
            <strong style="color: ${priorityColor};">${rec.title}</strong>
            <span style="margin-left: auto; font-size: 0.8rem; color: var(--muted);">${rec.priority === 'high' ? 'é«˜ä¼˜å…ˆçº§' : 'ä¸­ä¼˜å…ˆçº§'}</span>
          </div>
          <div style="font-size: 0.9rem; margin-bottom: 8px;">${rec.description}</div>
          <ul style="margin: 0; padding-left: 20px; font-size: 0.85rem;">
            ${rec.tips.map(tip => `<li>${tip}</li>`).join('')}
          </ul>
        </div>
      `;
    });
    
    html += '</div>';
  }
  
  elements.mealsContainer.innerHTML = html;
  elements.mealPlaceholder.style.display = 'none';
  elements.mealsContainer.style.display = 'block';
}

function getNutritionName(key) {
  const names = {
    protein: 'è›‹ç™½è´¨',
    carbs: 'ç¢³æ°´åŒ–åˆç‰©',
    fat: 'è„‚è‚ª',
    fiber: 'è†³é£Ÿçº¤ç»´',
    water: 'æ°´åˆ†',
    calcium: 'é’™è´¨',
    iron: 'é“è´¨',
    vitaminD: 'ç»´ç”Ÿç´ D',
    zinc: 'é”Œ'
  };
  return names[key] || key;
}

// ================= å¢å¼ºçš„åŒé¾„äººåˆ†æUI =================
function showEnhancedPeerAnalysis(data) {
  const ageGroup = getAgeGroup(data.age);
  const bmiCategory = getBMICategory(data.bmi).type;
  const analysis = getPeerHealthAnalysis(ageGroup, bmiCategory, allUsersData);
  
  let html = `
    <div style="margin-bottom: 20px; padding: 16px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(210, 82, 140, 0.1)); border-radius: 12px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
        <h3 style="font-size: 1.1rem; color: var(--primary);">ğŸ‘¥ ${ageGroup} å¥åº·æŠ¥å‘Š</h3>
        <span style="background: var(--primary); color: white; padding: 4px 12px; border-radius: 999px; font-size: 0.9rem;">
          æ ·æœ¬: ${analysis.peerCount} äºº
        </span>
      </div>
  `;
  
  if (analysis.stats.avgBMI !== 'æš‚æ— æ•°æ®') {
    html += `
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; text-align: center; margin-bottom: 16px;">
        <div>
          <div style="font-size: 1.5rem; font-weight: 600; color: var(--primary);">${analysis.stats.avgBMI}</div>
          <div style="font-size: 0.8rem; color: var(--muted);">å¹³å‡BMI</div>
        </div>
        <div>
          <div style="font-size: 1.5rem; font-weight: 600; color: var(--success);">${analysis.stats.minBMI}</div>
          <div style="font-size: 0.8rem; color: var(--muted);">æœ€ä½</div>
        </div>
        <div>
          <div style="font-size: 1.5rem; font-weight: 600; color: var(--danger);">${analysis.stats.maxBMI}</div>
          <div style="font-size: 0.8rem; color: var(--muted);">æœ€é«˜</div>
        </div>
      </div>
    `;
  }
  
  if (analysis.stats.bmiDistribution) {
    const total = analysis.peerCount;
    html += `
      <div style="margin-bottom: 16px;">
        <div style="font-size: 0.9rem; color: var(--dark); margin-bottom: 8px;">BMIåˆ†å¸ƒ</div>
        <div style="display: flex; height: 20px; border-radius: 10px; overflow: hidden; margin-bottom: 4px;">
          <div style="width: ${(analysis.stats.bmiDistribution.underweight / total) * 100}%; background: var(--info);"></div>
          <div style="width: ${(analysis.stats.bmiDistribution.normal / total) * 100}%; background: var(--success);"></div>
          <div style="width: ${(analysis.stats.bmiDistribution.overweight / total) * 100}%; background: var(--warning);"></div>
          <div style="width: ${(analysis.stats.bmiDistribution.obese / total) * 100}%; background: var(--danger);"></div>
        </div>
        <div style="display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--muted);">
          <span>åç˜¦: ${Math.round((analysis.stats.bmiDistribution.underweight / total) * 100) || 0}%</span>
          <span>æ­£å¸¸: ${Math.round((analysis.stats.bmiDistribution.normal / total) * 100) || 0}%</span>
          <span>è¶…é‡: ${Math.round((analysis.stats.bmiDistribution.overweight / total) * 100) || 0}%</span>
          <span>è‚¥èƒ–: ${Math.round((analysis.stats.bmiDistribution.obese / total) * 100) || 0}%</span>
        </div>
      </div>
    `;
  }
  
  html += '</div>';
  
  // è­¦å‘Šä¿¡æ¯
  if (analysis.warningSigns.length > 0) {
    html += `
      <div style="margin-bottom: 20px;">
        <h4 style="font-size: 1rem; color: var(--danger); margin-bottom: 12px;">âš ï¸ å¥åº·é¢„è­¦</h4>
    `;
    
    analysis.warningSigns.forEach(warning => {
      const levelColor = warning.level === 'high' ? 'var(--danger)' : 'var(--warning)';
      html += `
        <div style="margin-bottom: 12px; padding: 12px; background: rgba(245, 101, 101, 0.1); border-left: 4px solid ${levelColor};">
          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
            <i class="fas fa-exclamation-triangle" style="color: ${levelColor};"></i>
            <strong style="color: ${levelColor};">${warning.message}</strong>
          </div>
          <div style="font-size: 0.9rem; color: var(--dark);">${warning.action}</div>
        </div>
      `;
    });
    
    html += '</div>';
  }
  
  // è¯¦ç»†å»ºè®®
  html += `
    <div style="margin-bottom: 20px;">
      <h4 style="font-size: 1.1rem; color: var(--primary); margin-bottom: 12px;">ğŸ“‹ é’ˆå¯¹æ€§å»ºè®®</h4>
  `;
  
  analysis.recommendations.forEach((rec, index) => {
    const priorityColor = rec.priority === 'high' ? 'var(--danger)' : 'var(--warning)';
    const successColor = parseFloat(rec.successRate) > 80 ? 'var(--success)' : 
                         parseFloat(rec.successRate) > 60 ? 'var(--warning)' : 'var(--danger)';
    
    html += `
      <div style="margin-bottom: 20px; padding: 16px; border: 1px solid var(--border); border-radius: 12px; background: white;">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
          <div style="width: 32px; height: 32px; background: ${priorityColor}; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem;">
            ${index + 1}
          </div>
          <div>
            <div style="font-size: 1rem; font-weight: 600; color: var(--dark);">${rec.title}</div>
            <div style="font-size: 0.9rem; color: var(--muted);">${rec.description}</div>
          </div>
        </div>
        
        <div style="margin: 12px 0; font-size: 0.9rem; color: var(--dark);">
          ${rec.details.map((detail, i) => 
            `<div style="margin: 8px 0; padding-left: 8px; border-left: 2px solid var(--primary);">${detail}</div>`
          ).join('')}
        </div>
        
        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; color: var(--muted);">
          <div>
            <i class="fas fa-chart-line"></i>
            æˆåŠŸç‡: <strong style="color: ${successColor};">${rec.successRate}</strong>
          </div>
          <div>
            <i class="fas fa-calendar-alt"></i>
            å»ºè®®å‘¨æœŸ: ${rec.timeFrame}
          </div>
        </div>
      </div>
    `;
  });
  
  html += '</div>';
  
  // æˆåŠŸæ¡ˆä¾‹
  if (analysis.successStories.length > 0) {
    html += `
      <div style="margin-bottom: 20px;">
        <h4 style="font-size: 1.1rem; color: var(--primary); margin-bottom: 12px;">ğŸ† æˆåŠŸæ¡ˆä¾‹å‚è€ƒ</h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
    `;
    
    analysis.successStories.forEach(story => {
      html += `
        <div style="padding: 12px; background: rgba(72, 187, 120, 0.1); border-radius: 8px;">
          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
            <i class="fas fa-user-check" style="color: var(--success);"></i>
            <div style="font-weight: 500; color: var(--dark);">${story.name}</div>
            <span style="font-size: 0.8rem; background: var(--success); color: white; padding: 2px 8px; border-radius: 999px;">BMI:${story.bmi}</span>
          </div>
          <div style="font-size: 0.85rem; color: var(--muted); margin-bottom: 4px;">${story.duration} | ${story.age}å²</div>
          <div style="font-size: 0.85rem; color: var(--dark); margin-bottom: 8px;">${story.strategy}</div>
          <div style="font-size: 0.8rem; color: var(--success); font-weight: 500;">ç»“æœ: ${story.result}</div>
        </div>
      `;
    });
    
    html += `
        </div>
      </div>
    `;
  }
  
  // å¸¸è§é—®é¢˜
  if (analysis.commonIssues.length > 0) {
    html += `
      <div style="margin-bottom: 20px;">
        <h4 style="font-size: 1.1rem; color: var(--primary); margin-bottom: 12px;">ğŸ” å¸¸è§é—®é¢˜ä¸å¯¹ç­–</h4>
    `;
    
    analysis.commonIssues.forEach(issue => {
      html += `
        <div style="margin-bottom: 12px; padding: 12px; border: 1px solid var(--border); border-radius: 8px;">
          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
            <i class="fas fa-exclamation-circle" style="color: ${
              issue.severity === 'high' ? 'var(--danger)' : 
              issue.severity === 'medium' ? 'var(--warning)' : 'var(--info)'
            };"></i>
            <div style="font-weight: 500; color: var(--dark);">${issue.title}</div>
            <span style="font-size: 0.7rem; color: white; padding: 2px 8px; border-radius: 999px; background: ${
              issue.severity === 'high' ? 'var(--danger)' : 
              issue.severity === 'medium' ? 'var(--warning)' : 'var(--info)'
            };">
              ${issue.severity === 'high' ? 'é«˜å…³æ³¨' : issue.severity === 'medium' ? 'ä¸­å…³æ³¨' : 'ä¿¡æ¯'}
            </span>
          </div>
          <div style="font-size: 0.9rem; margin-bottom: 8px;">${issue.description}</div>
          <div style="font-size: 0.85rem;">
            <strong>è§£å†³æ–¹æ¡ˆ:</strong>
            <ul style="margin: 4px 0 0 0; padding-left: 20px; color: var(--dark);">
              ${issue.suggestions.map(s => `<li>${s}</li>`).join('')}
            </ul>
          </div>
        </div>
      `;
    });
    
    html += '</div>';
  }
  
  // è¡ŒåŠ¨è®¡åˆ’
  html += `
    <div style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, var(--primary), var(--primary-light)); color: white; border-radius: 12px;">
      <h4 style="margin-bottom: 12px; font-size: 1.1rem;">ğŸ“… ${ageGroup} å¥åº·è¡ŒåŠ¨è®¡åˆ’</h4>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 16px;">
        <div>
          <div style="font-size: 0.9rem; opacity: 0.9;">ç¬¬1å‘¨</div>
          <div style="font-weight: 500;">è®°å½•é¥®é£Ÿä¸è¿åŠ¨</div>
        </div>
        <div>
          <div style="font-size: 0.9rem; opacity: 0.9;">ç¬¬2-4å‘¨</div>
          <div style="font-weight: 500;">å»ºç«‹å¥åº·ä¹ æƒ¯</div>
        </div>
        <div>
          <div style="font-size: 0.9rem; opacity: 0.9;">ç¬¬1-3æœˆ</div>
          <div style="font-weight: 500;">å·©å›ºä¸ä¼˜åŒ–</div>
        </div>
      </div>
      <div style="font-size: 0.9rem; opacity: 0.9;">æ¯å‘¨æ£€æŸ¥ä¸€æ¬¡è¿›å±•ï¼Œæ¯æœˆè¯„ä¼°ä¸€æ¬¡æ•ˆæœï¼Œé€‚æ—¶è°ƒæ•´è®¡åˆ’</div>
    </div>
  `;
  
  // æ›´æ–°åŒé¾„äººåˆ†æå®¹å™¨
  const peerContainer = document.getElementById('peerAdviceList');
  if (peerContainer) {
    peerContainer.innerHTML = html;
  }
}

// ================= æ›´æ–°UIå‡½æ•° =================
function updateUIAfterSave(data) {
  // å¢å¼ºçš„è†³é£Ÿå»ºè®®
  showEnhancedDietAdvice(data);
  
  // å¢å¼ºçš„åŒé¾„äººåˆ†æ
  showEnhancedPeerAnalysis(data);
  
  // æ›´æ–°ç”¨æˆ·è¡¨æ ¼
  addUserToTable(data);
  
  // æ›´æ–°ç»Ÿè®¡æ•°æ®
  updateStatistics();
  
  // æ›´æ–°å›¾è¡¨
  updateChart();
  
  // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
  showSuccessMessage('æ•°æ®åˆ†æå®Œæˆï¼å·²ç”Ÿæˆä¸ªæ€§åŒ–å¥åº·å»ºè®®');
}

// ================= ä¸»å‡½æ•°è°ƒç”¨ =================
// ç¡®ä¿åœ¨é¡µé¢åŠ è½½æ—¶è°ƒç”¨
// ç¡®ä¿åœ¨ä¿å­˜æ•°æ®æ—¶è°ƒç”¨
// ç¡®ä¿åœ¨æ˜¾ç¤ºç¤ºä¾‹æ•°æ®æ—¶è°ƒç”¨
</script>
</body>
</html>
