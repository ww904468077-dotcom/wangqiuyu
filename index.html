<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½å¥åº·ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .hidden {
            display: none;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .info-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .info-card h3 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .info-card p {
            font-size: 2em;
            font-weight: bold;
        }

        .meal-plan {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .meal-plan h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .meal-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .meal-item h4 {
            color: #333;
            margin-bottom: 8px;
        }

        .meal-item ul {
            list-style: none;
            padding-left: 10px;
        }

        .meal-item li {
            padding: 5px 0;
            color: #666;
        }

        .calories-badge {
            display: inline-block;
            background: #ff6b6b;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .unhealthy-foods {
            background: #fff3cd;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid #ffc107;
        }

        .unhealthy-foods h3 {
            color: #ff6b6b;
            margin-bottom: 15px;
        }

        .food-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .food-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .exercise-section {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .exercise-section h3 {
            color: #1976d2;
            margin-bottom: 15px;
        }

        .exercise-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .statistics {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .stat-bar {
            margin: 15px 0;
        }

        .stat-bar h4 {
            color: #333;
            margin-bottom: 8px;
        }

        .bar-container {
            background: #e0e0e0;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            transition: width 1s ease;
        }

        .health-tip {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .health-tip h3 {
            margin-bottom: 10px;
        }

        .logout-btn {
            background: #ff6b6b;
            padding: 10px 30px;
            margin-top: 20px;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .alert-error {
            background: #fee;
            color: #c33;
            border: 1px solid #fcc;
        }

        .alert-success {
            background: #efe;
            color: #3c3;
            border: 1px solid #cfc;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¥ æ™ºèƒ½å¥åº·ç®¡ç†ç³»ç»Ÿ</h1>
            <p>æ‚¨çš„ä¸“å±å¥åº·é¡¾é—®</p>
        </div>

        <!-- ç™»å½•è¡¨å• -->
        <div id="loginForm" class="card">
            <h2 style="color: #667eea; margin-bottom: 20px; text-align: center;">ç”¨æˆ·ä¿¡æ¯ç™»å½•</h2>
            <div id="alertContainer"></div>
            <div class="form-group">
                <label>å§“å</label>
                <input type="text" id="name" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" required>
            </div>
            <div class="form-group">
                <label>èº«é«˜ (cm)</label>
                <input type="number" id="height" placeholder="ä¾‹å¦‚ï¼š170" required min="100" max="250">
            </div>
            <div class="form-group">
                <label>ä½“é‡ (kg)</label>
                <input type="number" id="weight" placeholder="ä¾‹å¦‚ï¼š65" required min="30" max="200">
            </div>
            <div class="form-group">
                <label>å¹´é¾„</label>
                <input type="number" id="age" placeholder="ä¾‹å¦‚ï¼š25" required min="1" max="120">
            </div>
            <button class="btn" id="loginBtn">å¼€å§‹å¥åº·ç®¡ç†</button>
        </div>

        <!-- ä¸»ä»ªè¡¨æ¿ -->
        <div id="dashboard" class="hidden">
            <div class="card">
                <h2 style="color: #667eea; margin-bottom: 20px;">æ¬¢è¿å›æ¥ï¼Œ<span id="userName"></span>ï¼</h2>
                
                <div class="dashboard">
                    <div class="info-card">
                        <h3>BMIæŒ‡æ•°</h3>
                        <p id="bmiValue"></p>
                        <small id="bmiStatus"></small>
                    </div>
                    <div class="info-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <h3>æ¯æ—¥æ¨èçƒ­é‡</h3>
                        <p id="dailyCalories"></p>
                    </div>
                    <div class="info-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                        <h3>å¥åº·çŠ¶æ€</h3>
                        <p id="healthStatus"></p>
                    </div>
                </div>

                <!-- ä¸ªæ€§åŒ–å¥åº·æç¤º -->
                <div class="health-tip">
                    <h3>ğŸ’¡ ä¸ªæ€§åŒ–å¥åº·å»ºè®®</h3>
                    <p id="healthAdvice"></p>
                </div>

                <!-- å¥åº·é£Ÿè°± -->
                <div class="meal-plan">
                    <h3>ğŸ½ï¸ ä»Šæ—¥å¥åº·é£Ÿè°±</h3>
                    <div id="mealPlanContent"></div>
                </div>

                <!-- ä¸å¥åº·é£Ÿå“çƒ­é‡ -->
                <div class="unhealthy-foods">
                    <h3>âš ï¸ ä¸å¥åº·é£Ÿå“çƒ­é‡å¯¹ç…§</h3>
                    <p style="color: #666; margin-bottom: 15px;">è¿™äº›é£Ÿå“åº”è¯¥é€‚é‡é£Ÿç”¨</p>
                    <div class="food-grid" id="unhealthyFoods"></div>
                </div>

                <!-- è¿åŠ¨å»ºè®® -->
                <div class="exercise-section">
                    <h3>ğŸƒ è¿åŠ¨å»ºè®®</h3>
                    <p style="color: #666; margin-bottom: 15px;">ä»¥ä¸‹è¿åŠ¨å¯ä»¥å¸®åŠ©æ‚¨æ¶ˆè€—çƒ­é‡</p>
                    <div id="exerciseContent"></div>
                </div>

                <!-- ç”¨æˆ·ç¾¤ä½“ç»Ÿè®¡ -->
                <div class="statistics">
                    <h3 style="color: #667eea; margin-bottom: 20px;">ğŸ“Š ç”¨æˆ·å¥åº·æ•°æ®ç»Ÿè®¡</h3>
                    <div id="statisticsContent"></div>
                </div>

                <button class="btn logout-btn" id="logoutBtn">é€€å‡ºç™»å½•</button>
            </div>
        </div>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, push, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyABck4GsHq7x68LUQQ0tqPg9Lj6XoYXi1g",
            authDomain: "project-2607536693074291471.firebaseapp.com",
            databaseURL: "https://project-2607536693074291471-default-rtdb.firebaseio.com",
            projectId: "project-2607536693074291471",
            storageBucket: "project-2607536693074291471.firebasestorage.app",
            messagingSenderId: "841252265184",
            appId: "1:841252265184:web:f074d1a9c5e67bb05ec485",
            measurementId: "G-3G47LDC4KB"
        };

        // Initialize Firebase
        let app, database, analytics;
        let isFirebaseInitialized = false;

        try {
            app = initializeApp(firebaseConfig);
            database = getDatabase(app);
            analytics = getAnalytics(app);
            isFirebaseInitialized = true;
            console.log('âœ… Firebase åˆå§‹åŒ–æˆåŠŸ');
        } catch (error) {
            console.error('âŒ Firebase åˆå§‹åŒ–å¤±è´¥:', error);
            showAlert('Firebase åˆå§‹åŒ–å¤±è´¥: ' + error.message, 'error');
        }

        // å…¨å±€å˜é‡
        let currentUser = null;

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showAlert(message, type = 'error') {
            const alertContainer = document.getElementById('alertContainer');
            const alertClass = type === 'error' ? 'alert-error' : 'alert-success';
            alertContainer.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }

        // è®¡ç®—BMI
        function calculateBMI(height, weight) {
            const heightInMeters = height / 100;
            return (weight / (heightInMeters * heightInMeters)).toFixed(1);
        }

        // è·å–BMIçŠ¶æ€
        function getBMIStatus(bmi) {
            if (bmi < 18.5) return "åç˜¦";
            if (bmi < 24) return "æ­£å¸¸";
            if (bmi < 28) return "åèƒ–";
            return "è‚¥èƒ–";
        }

        // è®¡ç®—æ¯æ—¥æ¨èçƒ­é‡
        function calculateDailyCalories(weight, height, age, gender = 'male') {
            if (gender === 'male') {
                return Math.round(88.362 + (13.397 * weight) + (4.799 * height) - (5.677 * age));
            } else {
                return Math.round(447.593 + (9.247 * weight) + (3.098 * height) - (4.330 * age));
            }
        }

        // ç”Ÿæˆå¥åº·é£Ÿè°±
        function generateMealPlan(bmi, age, dailyCalories) {
            const breakfast = {
                title: "æ—©é¤",
                foods: [
                    { name: "ç‡•éº¦ç²¥", calories: 150, desc: "å¯Œå«è†³é£Ÿçº¤ç»´" },
                    { name: "ç…®é¸¡è›‹", calories: 80, desc: "ä¼˜è´¨è›‹ç™½è´¨" },
                    { name: "å…¨éº¦é¢åŒ…", calories: 120, desc: "å¤åˆç¢³æ°´åŒ–åˆç‰©" },
                    { name: "ç‰›å¥¶", calories: 100, desc: "é’™è´¨è¡¥å……" }
                ]
            };

            const lunch = {
                title: "åˆé¤",
                foods: [
                    { name: "ç³™ç±³é¥­", calories: 200, desc: "100å…‹" },
                    { name: "é¸¡èƒ¸è‚‰", calories: 165, desc: "150å…‹ï¼Œä½è„‚é«˜è›‹ç™½" },
                    { name: "è¥¿å…°èŠ±", calories: 50, desc: "ç»´ç”Ÿç´ Cä¸°å¯Œ" },
                    { name: "ç•ªèŒ„ç‚’è›‹", calories: 120, desc: "è¥å…»å‡è¡¡" }
                ]
            };

            const dinner = {
                title: "æ™šé¤",
                foods: [
                    { name: "ç´«è–¯", calories: 120, desc: "100å…‹ï¼Œå¯Œå«èŠ±é’ç´ " },
                    { name: "æ¸…è’¸é±¼", calories: 150, desc: "150å…‹ï¼ŒOmega-3" },
                    { name: "è èœæ±¤", calories: 40, desc: "è¡¥é“" },
                    { name: "è±†è…", calories: 80, desc: "æ¤ç‰©è›‹ç™½" }
                ]
            };

            return [breakfast, lunch, dinner];
        }

        // ä¸å¥åº·é£Ÿå“æ•°æ®
        const unhealthyFoods = [
            { name: "ç‚¸é¸¡", calories: 500, unit: "200å…‹" },
            { name: "å•¤é…’", calories: 150, unit: "330ml" },
            { name: "è–¯æ¡", calories: 320, unit: "100å…‹" },
            { name: "æ±‰å ¡", calories: 550, unit: "1ä¸ª" },
            { name: "å¥¶èŒ¶", calories: 400, unit: "500ml" },
            { name: "å·§å…‹åŠ›", calories: 550, unit: "100å…‹" },
            { name: "æŠ«è¨", calories: 280, unit: "1ç‰‡" },
            { name: "å¯ä¹", calories: 140, unit: "330ml" }
        ];

        // è¿åŠ¨æ¶ˆè€—æ•°æ®
        function getExerciseSuggestions(calories) {
            return [
                { name: "å¿«èµ°", time: Math.round(calories / 5), calories: calories },
                { name: "æ…¢è·‘", time: Math.round(calories / 10), calories: calories },
                { name: "æ¸¸æ³³", time: Math.round(calories / 12), calories: calories },
                { name: "éª‘è‡ªè¡Œè½¦", time: Math.round(calories / 8), calories: calories },
                { name: "è·³ç»³", time: Math.round(calories / 15), calories: calories }
            ];
        }

        // ç™»å½•å‡½æ•°
        async function handleLogin() {
            const loginBtn = document.getElementById('loginBtn');
            const name = document.getElementById('name').value.trim();
            const height = parseFloat(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const age = parseInt(document.getElementById('age').value);

            // éªŒè¯è¾“å…¥
            if (!name || !height || !weight || !age) {
                showAlert('è¯·å¡«å†™æ‰€æœ‰ä¿¡æ¯ï¼', 'error');
                return;
            }

            if (height < 100 || height > 250) {
                showAlert('èº«é«˜åº”åœ¨100-250cmä¹‹é—´ï¼', 'error');
                return;
            }

            if (weight < 30 || weight > 200) {
                showAlert('ä½“é‡åº”åœ¨30-200kgä¹‹é—´ï¼', 'error');
                return;
            }

            if (age < 1 || age > 120) {
                showAlert('å¹´é¾„åº”åœ¨1-120å²ä¹‹é—´ï¼', 'error');
                return;
            }

            // ç¦ç”¨æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤æäº¤
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<span class="loading"></span> æ­£åœ¨ä¿å­˜...';

            const bmi = calculateBMI(height, weight);
            const bmiStatus = getBMIStatus(bmi);
            const dailyCalories = calculateDailyCalories(weight, height, age);

            const userData = {
                name: name,
                height: height,
                weight: weight,
                age: age,
                bmi: parseFloat(bmi),
                bmiStatus: bmiStatus,
                timestamp: Date.now()
            };

            if (!isFirebaseInitialized) {
                showAlert('Firebase æœªæ­£ç¡®åˆå§‹åŒ–ï¼Œæ•°æ®å°†ä»…ä¿å­˜åœ¨æœ¬åœ°', 'error');
                loginBtn.disabled = false;
                loginBtn.textContent = 'å¼€å§‹å¥åº·ç®¡ç†';
                currentUser = userData;
                showDashboard(userData, dailyCalories);
                return;
            }

            try {
                // ä¿å­˜åˆ°Firebase
                const usersRef = ref(database, 'users');
                const newUserRef = push(usersRef);
                await set(newUserRef, userData);
                
                console.log('âœ… æ•°æ®ä¿å­˜æˆåŠŸ');
                showAlert('ç™»å½•æˆåŠŸï¼', 'success');
                
                currentUser = userData;
                showDashboard(userData, dailyCalories);
                loadStatistics();
                
            } catch (error) {
                console.error('âŒ ä¿å­˜æ•°æ®å¤±è´¥:', error);
                showAlert('ä¿å­˜æ•°æ®å¤±è´¥: ' + error.message + 'ã€‚æ•°æ®å°†ä»…ä¿å­˜åœ¨æœ¬åœ°ã€‚', 'error');
                
                // å³ä½¿ä¿å­˜å¤±è´¥ï¼Œä¹Ÿæ˜¾ç¤ºä»ªè¡¨æ¿
                currentUser = userData;
                showDashboard(userData, dailyCalories);
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'å¼€å§‹å¥åº·ç®¡ç†';
            }
        }

        // æ˜¾ç¤ºä»ªè¡¨æ¿
        function showDashboard(userData, dailyCalories) {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('userName').textContent = userData.name;
            document.getElementById('bmiValue').textContent = userData.bmi;
            document.getElementById('bmiStatus').textContent = userData.bmiStatus;
            document.getElementById('dailyCalories').textContent = dailyCalories + ' å¡';
            document.getElementById('healthStatus').textContent = userData.bmiStatus === 'æ­£å¸¸' ? 'è‰¯å¥½' : 'éœ€æ”¹å–„';

            // ä¸ªæ€§åŒ–å¥åº·å»ºè®®
            let advice = '';
            if (userData.bmi < 18.5) {
                advice = 'æ‚¨çš„ä½“é‡åè½»ï¼Œå»ºè®®å¢åŠ è¥å…»æ‘„å…¥ï¼Œå¤šåƒé«˜è›‹ç™½é£Ÿç‰©ï¼Œé€‚é‡è¿åŠ¨å¢å¼ºä½“è´¨ã€‚';
            } else if (userData.bmi < 24) {
                advice = 'æ‚¨çš„ä½“é‡æ­£å¸¸ï¼Œä¿æŒè‰¯å¥½çš„é¥®é£Ÿä¹ æƒ¯å’Œè¿åŠ¨ä¹ æƒ¯ï¼Œç»§ç»­ä¿æŒï¼';
            } else if (userData.bmi < 28) {
                advice = 'æ‚¨çš„ä½“é‡åé‡ï¼Œå»ºè®®æ§åˆ¶é¥®é£Ÿçƒ­é‡ï¼Œå¢åŠ æœ‰æ°§è¿åŠ¨ï¼Œæ¯å‘¨è‡³å°‘è¿åŠ¨3-4æ¬¡ã€‚';
            } else {
                advice = 'æ‚¨çš„ä½“é‡è¶…æ ‡è¾ƒå¤šï¼Œå»ºè®®å’¨è¯¢è¥å…»å¸ˆåˆ¶å®šå‡é‡è®¡åˆ’ï¼Œé…åˆè§„å¾‹è¿åŠ¨ï¼Œæ”¹å–„é¥®é£Ÿç»“æ„ã€‚';
            }

            if (userData.age > 50) {
                advice += ' ç”±äºæ‚¨çš„å¹´é¾„è¾ƒå¤§ï¼Œå»ºè®®å®šæœŸä½“æ£€ï¼Œæ³¨æ„å¿ƒè¡€ç®¡å¥åº·ã€‚';
            } else if (userData.age < 25) {
                advice += ' æ‚¨è¿˜å¹´è½»ï¼Œå…»æˆè‰¯å¥½çš„ç”Ÿæ´»ä¹ æƒ¯å°†å—ç›Šç»ˆç”Ÿã€‚';
            }

            document.getElementById('healthAdvice').textContent = advice;

            // æ˜¾ç¤ºé£Ÿè°±
            const mealPlan = generateMealPlan(userData.bmi, userData.age, dailyCalories);
            let mealHTML = '';
            mealPlan.forEach(meal => {
                const totalCalories = meal.foods.reduce((sum, food) => sum + food.calories, 0);
                mealHTML += `
                    <div class="meal-item">
                        <h4>${meal.title} <span class="calories-badge">${totalCalories} å¡</span></h4>
                        <ul>
                            ${meal.foods.map(food => `<li>â€¢ ${food.name} - ${food.calories}å¡ (${food.desc})</li>`).join('')}
                        </ul>
                    </div>
                `;
            });
            document.getElementById('mealPlanContent').innerHTML = mealHTML;

            // æ˜¾ç¤ºä¸å¥åº·é£Ÿå“
            let unhealthyHTML = '';
            unhealthyFoods.forEach(food => {
                unhealthyHTML += `
                    <div class="food-card">
                        <h4>${food.name}</h4>
                        <p style="color: #ff6b6b; font-weight: bold; font-size: 1.2em;">${food.calories} å¡</p>
                        <small style="color: #666;">${food.unit}</small>
                    </div>
                `;
            });
            document.getElementById('unhealthyFoods').innerHTML = unhealthyHTML;

            // æ˜¾ç¤ºè¿åŠ¨å»ºè®®
            const exercises = getExerciseSuggestions(500);
            let exerciseHTML = '<p style="color: #666; margin-bottom: 10px;">æ¶ˆè€—ä¸€ä»½ç‚¸é¸¡ï¼ˆ500å¡ï¼‰éœ€è¦ï¼š</p>';
            exercises.forEach(ex => {
                exerciseHTML += `
                    <div class="exercise-item">
                        <span><strong>${ex.name}</strong></span>
                        <span style="color: #1976d2; font-weight: bold;">${ex.time} åˆ†é’Ÿ</span>
                    </div>
                `;
            });
            document.getElementById('exerciseContent').innerHTML = exerciseHTML;
        }

        // åŠ è½½ç»Ÿè®¡æ•°æ®
        function loadStatistics() {
            if (!isFirebaseInitialized) {
                document.getElementById('statisticsContent').innerHTML = '<p style="color: #666;">Firebaseæœªåˆå§‹åŒ–ï¼Œæ— æ³•åŠ è½½ç»Ÿè®¡æ•°æ®</p>';
                return;
            }

            try {
                const usersRef = ref(database, 'users');
                onValue(usersRef, (snapshot) => {
                    const data = snapshot.val();
                    if (!data) {
                        document.getElementById('statisticsContent').innerHTML = '<p style="color: #666;">æš‚æ— ç»Ÿè®¡æ•°æ®</p>';
                        return;
                    }

                    const users = Object.values(data);
                    
                    // æŒ‰å¹´é¾„æ®µåˆ†ç»„
                    const ageGroups = {
                        '18-30': { total: 0, normal: 0, overweight: 0 },
                        '31-45': { total: 0, normal: 0, overweight: 0 },
                        '46-60': { total: 0, normal: 0, overweight: 0 },
                        '60+': { total: 0, normal: 0, overweight: 0 }
                    };

                    users.forEach(user => {
                        let group;
                        if (user.age <= 30) group = '18-30';
                        else if (user.age <= 45) group = '31-45';
                        else if (user.age <= 60) group = '46-60';
                        else group = '60+';

                        ageGroups[group].total++;
                        if (user.bmi >= 18.5 && user.bmi < 24) {
                            ageGroups[group].normal++;
                        } else if (user.bmi >= 24) {
                            ageGroups[group].overweight++;
                        }
                    });

                    let statsHTML = '';
                    Object.keys(ageGroups).forEach(group => {
                        const stats = ageGroups[group];
                        if (stats.total > 0) {
                            const normalPercent = ((stats.normal / stats.total) * 100).toFixed(1);
                            const overweightPercent = ((stats.overweight / stats.total) * 100).toFixed(1);
                            
                            statsHTML += `
                                <div class="stat-bar">
                                    <h4>${group}å²å¹´é¾„æ®µ (æ€»äººæ•°: ${stats.total})</h4>
                                    <div style="margin-bottom: 10px;">
                                        <small>æ­£å¸¸ä½“é‡: ${normalPercent}%</small>
                                        <div class="bar-container">
                                            <div class="bar-fill" style="width: ${normalPercent}%; background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%);">
                                                ${normalPercent}%
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <small>è¶…é‡/è‚¥èƒ–: ${overweightPercent}%</small>
                                        <div class="bar-container">
                                            <div class="bar-fill" style="width: ${overweightPercent}%; background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);">
                                                ${overweightPercent}%
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }
                    });

                    if (statsHTML === '') {
                        statsHTML = '<p style="color: #666;">æš‚æ— ç»Ÿè®¡æ•°æ®</p>';
                    }

                    document.getElementById('statisticsContent').innerHTML = statsHTML;
                }, (error) => {
                    console.error('âŒ è¯»å–ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                    document.getElementById('statisticsContent').innerHTML = '<p style="color: #666;">åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥</p>';
                });
            } catch (error) {
                console.error('âŒ è®¾ç½®ç»Ÿè®¡ç›‘å¬å¤±è´¥:', error);
                document.getElementById('statisticsContent').innerHTML = '<p style="color: #666;">åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥</p>';
            }
        }

        // é€€å‡ºç™»å½•
        function handleLogout() {
            currentUser = null;
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('name').
